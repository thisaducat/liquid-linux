#!/bin/bash

# Function to check if a package is installed
is_installed() {
    dpkg -l | grep -q "$1"
}

# Define available desktop environments
environments=("xfce4" "gnome" "icewm")

# Filter installed environments
installed_environments=()
for environment in "${environments[@]}"; do
    if is_installed "$environment"; then
        installed_environments+=("$environment")
    fi
done

# Display menu if environments are installed
if [ ${#installed_environments[@]} -eq 0 ]; then
    echo "Yüklü masaüstü ortamı bulunamadı.."
else
    # Construct options for dialog menu
    options=()
    for environment in "${installed_environments[@]}"; do
        options+=("$environment" "")
    done

    # Show dialog menu
    DE=$(dialog --title "Masaüstü ortamını SEÇ" --menu "Lütfen kullanmak istediğiniz masaüstü ortamını seçin:" 12 50 6 "${options[@]}" 2>&1 >/dev/tty)

    # Execute commands based on selected environment
    case $DE in
        "xfce4")
            export DISPLAY=:0
            dbus-launch --exit-with-session startxfce4 &
            ;;
        "gnome")
            clear
            export DISPLAY=:0
            export XDG_CURRENT_DIR=GNOME
            for file in $(find /usr -type f -iname "*login1*"); do mv -v $file "$file.back"; done

            service dbus start
            gnome-shell --x11
            ;;
        "icewm")
            export DISPLAY=:0
            dbus-launch --exit-with-session icewm &
            ;;
        *)
            echo ""
            ;;
    esac
fi
